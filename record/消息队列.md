# 消息队列 MQ

> 本文整理自网络，侵删。

> Message Queue -> MQ.

消息队列是阿里巴巴中间件技术部自主研发的专业分布式消息中间件，用于保证异构应用之间的消息传递。应用程序通过 MQ 接口进行互连通信，可以不关系网络上的通信细节，从而将更多的注意力几种于应用本身。

分布式消息系统作为实现分布式系统可扩展、可伸缩性的关键组件，需要具有高吞吐量、高可用等特点。

## 对象

队列管理器是负责向应用程序提供消息服务的机构，我们可以把队列管理器比作是数据库，队列是其中的一张表，消息表中的一条记录。

### 消息

消息是一个非常小的概念，其本质上就是一条数据，能够被一个或多个应用程序所理解，是应用程序之间传递信息的载体。

消息大致可以分为两部分，应用数据体和消息数据头。消息数据头是对消息属性的描述，这段信息往往被队列管理器用来确定对消息的处理。

消息分为持久消息和非持久消息。而这里的持久，讲的就是在队列管理器重新启动后，消息是否仍能保持。

### 队列

队列可以分为本地队列，远程队列和模型队列。

#### 本地队列

而本地队列又可以分为初始化队列，传输队列，目标队列和死信队列。

- 初始化队列用做消息触发功能；
- 传输队列只是暂存待传的消息，条件许可的情况下，通过管道将消息传送其它的队列管理器；
- 目标队列是消息的目的地，可以长期存放消息；
- 如果消息不能送达目标队列，也不能再路由出去，则被自动放入死信队列保存。

#### 远程队列

用来指定远端队列管理器中的队列。使用了远程队列定义，程序就不需要知道目标队列的位置。

#### 模型队列

定义了一套本地队列的属性集合，一旦打开模型队列，队列管理器会按这些属性动态地创建出一个本地队列。

### 队列管理器

队列管理器可以含有很多个队列，但一个队列只能属于一个队列管理器。一个操作系统平台可以创建一个队列管理器，也可以创建多个队列管理器。

### 通道

通道是两个队列管理器之间的一种单向的点对点的通信连接，消息在通道中只能单向流动。也可以建立两个通道，来实现双向通信。

### 监听器

我们需要设定一个 Listener 来在异步情况下接收和读取信息，当消息到达时，自动调用 Listener 的相关方法，同步则不需要。

## 如何解决消息重复投递问题

增加消息应用状态表，在每次收到消息准备执行之前，先去消息应用状态表中查询一遍。重复则丢弃，无则执行。

## Ref

-[https://segmentfault.com/a/1190000015171440](https://segmentfault.com/a/1190000015171440)
