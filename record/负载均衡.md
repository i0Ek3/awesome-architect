# 负载均衡

> 以下内容均整理自网络，并非原创，侵删。

> Wiki: 负载均衡（Load balancing）是一种计算机技术，用来在多个计算机（计算机集群）、网络连接、CPU、磁盘驱动器或其他资源中分配负载，以达到最优化资源使用、最大化吞吐率、最小化响应时间、同时避免过载的目的。

负载均衡是将访问流量根据转发策略分发到后端多台云服务器（ECS实例）的流量分发控制服务。负载均衡扩展了应用的服务能力，增强了应用的可用性。

一个没有负载均衡的网络架构会在宕机的情况下导致无法访问服务器。而有负载均衡的架构中，便会缓解该问题的产生。负载均衡有多个维度，也有软硬之分。

其中，硬件负载均衡解决方案是直接在服务器和外部网络间安装负载均衡设备，这种设备我们通常称之为负载均衡器，由于专门的设备完成专门的任务，独立于操作系统，整体性能得到大量提高，加上多样化的负载均衡策略，智能化的流量管理，可达到最佳的负载均衡需求。

而软件负载均衡解决方案是指在一台或多台服务器相应的操作系统上安装一个或多个附加软件来实现负载均衡，它的优点是基于特定环境，配置简单，使用灵活，成本低廉，可以满足一般的负载均衡需求。常见的软件负载均衡有LVS、Nginx和HAProxy。


## 组成成分

- 负载均衡实例：一个负载均衡实例是一个运行的负载均衡服务，用来接收流量并将其分配给后端服务器。要使用负载均衡服务，您必须创建一个负载均衡实例，并至少添加一个监听和两台ECS实例。
- 监听：监听用来检查客户端请求并将请求转发给后端服务器。监听也会对后端服务器进行健康检查。
- 后端服务器：一组接收前端请求的ECS实例。你可以单独添加ECS实例到服务器池，也可以通过虚拟服务器组或主备服务器组来批量添加和管理。


## 基本原理

负载均衡通过设置虚拟服务地址，将添加的ECS实例虚拟成一个高性能、高可用的应用服务池，并根据转发规则，将来自客户端的请求分发给云服务器池中的ECS实例。


## 负载均衡算法

- 静态负载均衡算法
    - 轮询：为第一个请求选择列表中的第一个服务器，然后按顺序向下移动列表直到结尾，然后循环。
    - 比率：给每个服务器分配一个加权值为比例，根椐这个比例，把用户的请求分配到每个服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求的分配, 直到其恢复正常。
    - 优先权：给所有服务器分组,给每个组定义优先权，BIG-IP 用户的请求，分配给优先级最高的服务器组（在同一组内，采用轮询或比率算法，分配用户的请求）；当最高优先级中所有服务器出现故障，BIG-IP 才将请求送给次优先级的服务器组。这种方式，实际为用户提供一种热备份的方式。

- 动态负载均衡算法
    - 最小连接：优先选择连接数最少的服务器，在普遍会话较长的情况下推荐使用。
    - 最快响应速度：传递连接给那些响应最快的服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。
    - 观察模式：连接数目和响应时间以这两项的最佳平衡为依据为新的请求选择服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。

## 应用场景

- 流量分发
- 系统高可用
- 在线扩容、缩容


## Ref

- [https://zh.m.wikipedia.org/wiki/负载均衡](https://zh.m.wikipedia.org/wiki/负载均衡)
- [https://zhuanlan.zhihu.com/p/32841479](https://zhuanlan.zhihu.com/p/32841479)
- [https://www.alibabacloud.com/help/zh/doc-detail/27539.htm](https://www.alibabacloud.com/help/zh/doc-detail/27539.htm)


