# 编译优化

昨天面试官问我是否知道关于编译器结果优化的一些东西时，我似曾相识却又哑口无言。今天查了下资料，整理在这里，供自己日后复习。

## 简介

GCC 编译器为了满足用户而提供了不同程度的的优化需要，用来对编译时间，目标文件长度，执行效率这个三维模型进行不同的取舍和平衡。

优化的方法分为以下几类：

- 精简操作指令；
- 尽量满足cpu的流水操作；
- 通过对程序行为地猜测，重新调整代码的执行顺序；
- 充分使用寄存器；
- 对简单的调用进行展开；
- et al.

## 优化选项

- -O0

不作任何优化，编译器默认的编译选项，此时编译器会尽量缩小时间和空间的消耗。

- -O1

对程序进行部分编译优化，编译器会尝试减小生成代码的尺寸，以及缩短程序的执行时间。主要对代码的分支，常量以及表达式等进行优化。

- -O2

在 O1 的基础上，编译器会尝试更多的寄存器级别的优化和指令级别的优化。与 O1 相比，O2 选项在增加了编译时间的基础上，提高了生成代码的执行效率。缺点是在编译期间会占用更多的内存和编译时间。

- -O3

在 O2 的基础上，编译器会使用普通函数的内联函数、伪寄存器网络以及针对循环的更多优化。

- -Os

该选项对程序的代码大小进行优化，通常我们无需关注这样的优化。

## 存在的问题

尽管优化选项在一定程度上会带来好处，但是也会导致一些新的问题。如：

- 影响调试

因为优化将会打乱程序代码的结构，导致调试信息不足。

- 改变内存操作顺序

在 O2 优化后，编译器会影响内存操作的执行顺序。这对与某些严格依赖内存操作顺序的逻辑来说，不容乐观。



## References

- [https://blog.csdn.net/boylinux/article/details/28986261](https://blog.csdn.net/boylinux/article/details/28986261)
